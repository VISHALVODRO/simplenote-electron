(window.webpackJsonp=window.webpackJsonp||[]).push([[3,5],{1320:function(e,t,n){"use strict";n.r(t),n.d(t,"NoteEditor",(function(){return je}));var o=n(0),r=n.n(o),i=n(130),a=n(1294),c=n(387),u=n(177),s=Object(i.b)(null,(function(e){return{openShareDialog:function(){return e(Object(u.showDialog)("SHARE"))}}}))((function(e){var t=e.openShareDialog;return r.a.createElement("div",{className:"tag-email-tooltip"},r.a.createElement("div",{className:"tag-email-tooltip__arrow"}),r.a.createElement("div",{className:"tag-email-tooltip__inside"},"Collaboration has moved. Press the Share icon in the toolbar to access the ",r.a.createElement("a",{href:"#",onClick:t},"Collaborate screen"),"."))})),l=n(7),f=n.n(l),d=function(e){var t=e.onSelect,n=e.selected,o=e.tagName;return r.a.createElement("div",{className:f()("tag-chip",{selected:n}),"data-tag-name":o,onClick:t},o)},p=n(3);function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"==typeof e)return g(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return g(e,t)}(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,r,i=!0,a=!1;return{s:function(){o=e[Symbol.iterator]()},n:function(){var e=o.next();return i=e.done,e},e:function(e){a=!0,r=e},f:function(){try{i||null==o.return||o.return()}finally{if(a)throw r}}}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function w(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=T(e);if(t){var r=T(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return S(this,n)}}function S(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?E(e):t}function E(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function T(e){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function O(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var k=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}(a,e);var t,n,o,i=w(a);function a(){for(var e,t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return m(this,a),O(E(e=i.call.apply(i,[this].concat(n))),"inputField",void 0),O(E(e),"inputObserver",void 0),O(E(e),"state",{isComposing:!1}),O(E(e),"completeSuggestion",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p.identity,n=e.props,o=n.onChange,r=n.note,i=n.tags,a=n.value;if(a.length){var c,u=null,s=v(i.values());try{for(s.s();!(c=s.n()).done;){var l=c.value;if(!r.tags.includes(l.name)&&l.name.startsWith(a)){u=l.name;break}}}catch(e){s.e(e)}finally{s.f()}u&&o(u,(function(){t(u),e.focusInput()}))}})),O(E(e),"focusInput",(function(){if(e.inputField){var t=e.inputField;t.focus();var n=document.createRange();n.selectNodeContents(t),n.collapse(!1);var o=window.getSelection();o.removeAllRanges(),o.addRange(n)}})),O(E(e),"hasFocus",(function(){return document.activeElement===e.inputField})),O(E(e),"interceptKeys",(function(t){var n;return Object(p.invoke)((O(n={},13,e.submitTag),O(n,188,e.submitTag),O(n,9,e.interceptTabPress),O(n,39,e.interceptRightArrow),n),t.keyCode,t)})),O(E(e),"interceptRightArrow",(function(t){var n=e.props.value;window.getSelection().getRangeAt(0).endOffset===n.length&&(e.completeSuggestion(),t.preventDefault(),t.stopPropagation())})),O(E(e),"interceptTabPress",(function(t){e.completeSuggestion(e.submitTag),t.preventDefault(),t.stopPropagation()})),O(E(e),"onInputMutation",(function(t){t.forEach((function(t){var n=Object(p.get)(t,"target.data","");"childList"===t.type&&t.addedNodes.length&&(n=Object(p.get)(t,"target.innerText","")),e.onInput(n)}))})),O(E(e),"onInput",(function(t){e.state.isComposing||e.props.onChange(t.trim(),e.focusInput)})),O(E(e),"onCompositionEnd",(function(t){var n=t.target.textContent;e.setState({isComposing:!1},(function(){return e.onInput(n)}))})),O(E(e),"removePastedFormatting",(function(t){var n;Object(p.get)(t,"clipboardData.getData")?n=t.clipboardData.getData("text/plain"):Object(p.get)(window,"clipboardData.getData")&&(n=window.clipboardData.getData("Text")),e.onInput(n),t.preventDefault(),t.stopPropagation()})),O(E(e),"storeInput",(function(t){e.inputField=t,e.props.inputRef(t),Object(p.invoke)(E(e),"inputField.addEventListener","paste",e.removePastedFormatting,!1)})),O(E(e),"submitTag",(function(t){var n=e.props,o=n.onSelect,r=n.value;r.trim().length&&o(r.trim()),Object(p.invoke)(t,"preventDefault"),Object(p.invoke)(t,"stopPropagation")})),e}return t=a,(n=[{key:"componentDidMount",value:function(){this.props.storeFocusInput(this.focusInput),this.props.storeHasFocus(this.hasFocus),this.inputObserver=new MutationObserver(this.onInputMutation),this.inputObserver.observe(this.inputField,{characterData:!0,childList:!0,subtree:!0})}},{key:"componentWillUnmount",value:function(){Object(p.invoke)(this,"inputField.removeEventListener","paste",this.removePastedFormatting,!1),this.inputObserver.disconnect()}},{key:"render",value:function(){var e=this,t=this.props,n=t.note,o=t.tags,i=t.value,a=null;if(i.length>0){var c,u=v(o.values());try{for(u.s();!(c=u.n()).done;){var s=c.value;if(!n.tags.includes(s.name)&&s.name.startsWith(i)){a=s.name;break}}}catch(e){u.e(e)}finally{u.f()}}var l=""===i&&!this.state.isComposing;return r.a.createElement("div",{className:"tag-input",onClick:this.focusInput},l&&r.a.createElement("span",{"aria-hidden":!0,className:"tag-input__placeholder"},"Add a tag…"),r.a.createElement("div",{"aria-label":"Add a tag…",ref:this.storeInput,className:"tag-input__entry",contentEditable:"true",onCompositionStart:function(){return e.setState({isComposing:!0})},onCompositionEnd:this.onCompositionEnd,onKeyDown:this.interceptKeys,spellCheck:!1,suppressContentEditableWarning:!0},i),r.a.createElement("div",{className:"tag-input__suggestion",disabled:!0,type:"text"},a?a.substring(i.length):""))}}])&&y(t.prototype,n),o&&y(t,o),a}(o.Component);O(k,"displayName","TagInput"),O(k,"defaultProps",{inputRef:p.identity,onChange:p.identity,onSelect:p.identity,storeFocusInput:p.noop,storeHasFocus:p.noop});var N=Object(i.b)((function(e){return{note:e.data.notes.get(e.ui.openedNote),tags:e.data.tags[0]}}))(k),F=n(9);function C(e){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function I(e){return function(e){if(Array.isArray(e))return j(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return j(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return j(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function j(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function D(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function R(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function P(e,t){return(P=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=x(e);if(t){var r=x(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return L(this,n)}}function L(e,t){return!t||"object"!==C(t)&&"function"!=typeof t?A(e):t}function A(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function x(e){return(x=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function H(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var M=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&P(e,t)}(l,e);var t,n,i,u=_(l);function l(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return D(this,l),H(A(e=u.call.apply(u,[this].concat(n))),"container",Object(o.createRef)()),H(A(e),"focusInput",void 0),H(A(e),"hiddenTag",void 0),H(A(e),"inputHasFocus",void 0),H(A(e),"tagInput",Object(o.createRef)()),H(A(e),"state",{selectedTag:"",showEmailTooltip:!1,tagInput:""}),H(A(e),"addTag",(function(t){var n=e.props,o=n.note,r=n.noteId,i=t.trim().replace(/\s+/g,",").split(",");i.some(c.a)&&e.showEmailTooltip();var a=new Set(o.tags.map((function(e){return e.toLocaleLowerCase()})));I(o.tags);i.forEach((function(t){a.has(t.toLocaleLowerCase())||(a.add(t.toLocaleLowerCase()),e.props.addTag(r,t))})),e.storeTagInput(""),Object(p.invoke)(A(e),"tagInput.focus"),F.a.tracks.recordEvent("editor_tag_added")})),H(A(e),"hasSelection",(function(){return e.state.selectedTag&&!!e.state.selectedTag.length})),H(A(e),"deleteTag",(function(t){var n=e.props,o=(n.note,n.noteId),r=e.state.selectedTag;e.props.removeTag(o,t),r===t&&e.setState({selectedTag:""},(function(){var t,n;return null===(t=e.tagInput)||void 0===t||null===(n=t.current)||void 0===n?void 0:n.focus()})),F.a.tracks.recordEvent("editor_tag_removed")})),H(A(e),"deleteSelection",(function(){e.hasSelection()&&e.deleteTag(e.state.selectedTag)})),H(A(e),"hideEmailTooltip",(function(){return e.setState({showEmailTooltip:!1})})),H(A(e),"hasFocus",(function(){return e.inputHasFocus&&e.inputHasFocus()})),H(A(e),"focusTagField",(function(){return e.focusInput&&e.focusInput()})),H(A(e),"interceptKeys",(function(t){if(8===t.which){if(e.hasSelection()&&e.deleteSelection(),""!==e.state.tagInput)return;return e.selectLastTag(),void t.preventDefault()}if(39===t.which&&e.hasSelection())return e.unselect(t),void e.focusTagField();9===t.which&&e.hasSelection()&&e.unselect(t)})),H(A(e),"preventStealingFocus",(function(t){var n=t.ctrlKey,o=t.code,r=t.metaKey,i=t.shiftKey;if(e.props.keyboardShortcuts)return(n||r)&&i&&"KeyY"===o&&e.setState({selectedTag:""}),!0})),H(A(e),"selectLastTag",(function(){var t;return e.setState({selectedTag:null===(t=e.props.note)||void 0===t?void 0:t.tags.slice(-1).shift()})})),H(A(e),"selectTag",(function(t){var n=t.target.dataset.tagName;t.preventDefault(),t.stopPropagation(),e.deleteTag(n)})),H(A(e),"showEmailTooltip",(function(){e.setState({showEmailTooltip:!0}),setTimeout((function(){return e.setState({showEmailTooltip:!1})}),5e3)})),H(A(e),"onKeyDown",(function(t){return e.state.showEmailTooltip&&e.hideEmailTooltip(),e.interceptKeys(t)})),H(A(e),"storeFocusInput",(function(t){return e.focusInput=t})),H(A(e),"storeHasFocus",(function(t){return e.inputHasFocus=t})),H(A(e),"storeHiddenTag",(function(t){return e.hiddenTag=t})),H(A(e),"storeInputRef",(function(t){return e.tagInput=t})),H(A(e),"storeTagInput",(function(t,n){return e.setState({tagInput:t},n)})),H(A(e),"unselect",(function(t){var n;e.state.selectedTag&&(null===(n=e.hiddenTag)||void 0===n?void 0:n.current)!==t.relatedTarget&&e.setState({selectedTag:""})})),e}return t=l,(n=[{key:"componentDidMount",value:function(){this.props.storeFocusTagField(this.focusTagField),this.props.storeHasFocus(this.hasFocus),document.addEventListener("click",this.unselect,!0),window.addEventListener("keydown",this.preventStealingFocus,!0)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("click",this.unselect,!0),window.removeEventListener("keydown",this.preventStealingFocus,!0)}},{key:"componentDidUpdate",value:function(){var e,t;this.hasSelection()&&(null===(e=this.hiddenTag)||void 0===e||null===(t=e.current)||void 0===t||t.focus())}},{key:"render",value:function(){var e=this,t=this.props.note,n=this.state,o=n.selectedTag,i=n.showEmailTooltip,u=n.tagInput;return r.a.createElement("div",{ref:this.container,className:"tag-field"},r.a.createElement("div",{className:f()("tag-editor",{"has-selection":this.hasSelection()}),tabIndex:-1,onKeyDown:this.onKeyDown},r.a.createElement("input",{className:"hidden-tag",tabIndex:-1,ref:this.storeHiddenTag}),null==t?void 0:t.tags.filter(Object(p.negate)(c.a)).map((function(t){return r.a.createElement(d,{key:t,tagName:t,selected:t===o,onSelect:e.selectTag})})),r.a.createElement(N,{inputRef:this.storeInputRef,value:u,onChange:this.storeTagInput,onSelect:this.addTag,storeFocusInput:this.storeFocusInput,storeHasFocus:this.storeHasFocus}),r.a.createElement(a.a,{container:this.container.current,onHide:this.hideEmailTooltip,placement:"top",rootClose:!0,shouldUpdatePosition:!0,show:i,target:this.tagInput.current},(function(){return r.a.createElement(s,null)}))))}}])&&R(t.prototype,n),i&&R(t,i),l}(o.Component);H(M,"displayName","TagField");var K=Object(i.b)((function(e){return{allTags:e.data.tags[0],keyboardShortcuts:e.settings.keyboardShortcuts,noteId:e.ui.openedNote,note:e.data.notes.get(e.ui.openedNote)}}),{addTag:function(e,t){return{type:"ADD_NOTE_TAG",noteId:e,tagName:t}},removeTag:function(e,t){return{type:"REMOVE_NOTE_TAG",noteId:e,tagName:t}}})(M),W=n(956),U=n.n(W),z=n(1029),$=n(152),q=n(204);function B(e){return(B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Q(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],o=!0,r=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(o=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);o=!0);}catch(e){r=!0,i=e}finally{try{o||null==c.return||c.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return G(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return G(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function G(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function J(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Y(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function X(e,t){return(X=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function V(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=te(e);if(t){var r=te(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Z(this,n)}}function Z(e,t){return!t||"object"!==B(t)&&"function"!=typeof t?ee(e):t}function ee(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function te(e){return(te=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ne(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var oe=function(e){return e.replace(/^(\s*)- \[ \](\s)/gm,"$1$2").replace(/^(\s*)- \[x\](\s)/gim,"$1$2")},re=function(e){return e.replace(/\ue000/g,"- [ ]").replace(/\ue001/g,"- [x]")},ie=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&X(e,t)}(a,e);var t,n,o,i=V(a);function a(){var e;J(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return ne(ee(e=i.call.apply(i,[this].concat(n))),"editor",null),ne(ee(e),"state",{content:"",editor:"fast",noteId:null,overTodo:!1}),ne(ee(e),"handleKeys",(function(t){if(e.props.keyboardShortcuts){var n=t.code,o=t.ctrlKey,r=t.metaKey,i=t.shiftKey;return!(o||r)||!i||"KeyC"!==n||(e.props.insertTask(),t.stopPropagation(),t.preventDefault(),!1)}})),ne(ee(e),"editorReady",(function(t,n){var o,r;window.editor=t,window.monaco=n,e.editor=t;var i=function(e){return{range:new n.Range(e,1,e,1),options:{isWholeLine:!0,inlineClassName:"note-title",stickiness:z.editor.TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges}}},a=[],c=function(){var e=t.getModel();if(e)for(var n=1;n<=e.getLineCount();n++){if(e.getLineContent(n).trim().length>0){a=t.deltaDecorations(a,[i(n)]);break}}else a=[]};c(),t.onDidChangeModelContent((function(){return c()})),document.oncopy=function(e){e.clipboardData.setData("text/plain",re(e.clipboardData.getData("text/plain")))};var u=Q(e.props.editorSelection,3),s=u[0],l=u[1],f=u[2],d=null===(o=e.editor.getModel())||void 0===o?void 0:o.getPositionAt(s),p=null===(r=e.editor.getModel())||void 0===r?void 0:r.getPositionAt(l);e.editor.setSelection(z.Selection.createWithDirection(null==d?void 0:d.lineNumber,null==d?void 0:d.column,null==p?void 0:p.lineNumber,null==p?void 0:p.column,"RTL"===f?z.SelectionDirection.RTL:z.SelectionDirection.LTR)),t.revealLine(d.lineNumber,z.editor.ScrollType.Immediate),t.focus(),t.onDidChangeCursorSelection((function(n){var o,r;if(n.reason!==z.editor.CursorChangeReason.Undo&&n.reason!==z.editor.CursorChangeReason.Redo){var i=null===(o=t.getModel())||void 0===o?void 0:o.getOffsetAt(n.selection.getStartPosition()),a=null===(r=t.getModel())||void 0===r?void 0:r.getOffsetAt(n.selection.getEndPosition()),c=n.selection.getDirection()===z.SelectionDirection.LTR?"LTR":"RTL";e.props.storeEditorSelection(e.props.noteId,i,a,c)}})),t.onMouseMove((function(n){var o=e.state.content,r=n.target.range,i=t.getModel().getOffsetAt({lineNumber:r.startLineNumber,column:r.startColumn});e.setState({overTodo:""===o[i]||""===o[i]})})),t.onMouseDown((function(n){var o=e.props,r=o.editNote,i=o.noteId,a=e.state.content,c=n.target.range,u=t.getModel().getOffsetAt({lineNumber:c.startLineNumber,column:c.startColumn});""===a[u]?r(i,{content:a.slice(0,u)+""+a.slice(u+1)}):""===a[u]&&r(i,{content:a.slice(0,u)+""+a.slice(u+1)})}))})),ne(ee(e),"updateNote",(function(t,n){var o=e.props;(0,o.editNote)(o.noteId,{content:re(t)})})),e}return t=a,o=[{key:"getDerivedStateFromProps",value:function(e,t){return e.noteId!==t.noteId?{content:e.note.content.slice(0,e.editorSelection[1]+5e3),editor:"fast",noteId:e.noteId}:e.note.content!==t.content?{content:oe(e.note.content)}:null}}],(n=[{key:"componentDidMount",value:function(){var e=this,t=this.props.noteId;window.addEventListener("keydown",this.handleKeys,!0),setTimeout((function(){t===e.props.noteId&&e.setState({editor:"full",content:oe(e.props.note.content)})}),120)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this.handleKeys,!0)}},{key:"componentDidUpdate",value:function(e){var t=this,n=Q(e.editorSelection,3),o=n[0],r=n[1],i=n[2],a=this.props,c=a.noteId,u=Q(a.editorSelection,3),s=u[0],l=u[1],f=u[2];if(this.editor&&"full"===this.state.editor&&(o!==s||r!==l||i!==f)){var d,p,h=null===(d=this.editor.getModel())||void 0===d?void 0:d.getPositionAt(s),v=null===(p=this.editor.getModel())||void 0===p?void 0:p.getPositionAt(l);this.editor.setSelection(z.Selection.createWithDirection(null==h?void 0:h.lineNumber,null==h?void 0:h.column,null==v?void 0:v.lineNumber,null==v?void 0:v.column,"RTL"===f?z.SelectionDirection.RTL:z.SelectionDirection.LTR))}"fast"===this.state.editor&&setTimeout((function(){c===t.props.noteId&&t.setState({editor:"full",content:oe(t.props.note.content)})}),120)}},{key:"render",value:function(){var e=this.props,t=e.fontSize,n=e.noteId,o=e.theme,i=this.state,a=i.content,c=i.editor,u=i.overTodo;return r.a.createElement("div",{className:"note-content-editor-shell".concat(u?" cursor-pointer":"")},"fast"===c?r.a.createElement("div",{style:{padding:"0.7em",whiteSpace:"pre-wrap"}},a):r.a.createElement(U.a,{key:n,editorDidMount:this.editorReady,language:"plaintext",theme:"dark"===o?"vs-dark":"vs",onChange:this.updateNote,options:{autoClosingBrackets:"never",autoClosingQuotes:"never",autoIndent:"keep",autoSurround:"never",automaticLayout:!0,codeLens:!1,contextmenu:!1,folding:!1,fontFamily:'"Simplenote Tasks", -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen-Sans", "Ubuntu", "Cantarell", "Helvetica Neue", sans-serif',fontSize:t,hideCursorInOverviewRuler:!0,lineHeight:t>20?42:24,lineNumbers:"off",links:!0,minimap:{enabled:!1},occurrencesHighlight:!1,overviewRulerBorder:!1,quickSuggestions:!1,renderIndentGuides:!1,renderLineHighlight:"none",scrollbar:{horizontal:"hidden"},selectionHighlight:!1,wordWrap:"on",wrappingStrategy:"simple"},value:a}))}}])&&Y(t.prototype,n),o&&Y(t,o),a}(o.Component),ae={editNote:$.a.data.editNote,insertTask:function(){return{type:"INSERT_TASK"}},storeEditorSelection:function(e,t,n,o){return{type:"STORE_EDITOR_SELECTION",noteId:e,start:t,end:n,direction:o}}},ce=Object(i.b)((function(e){var t;return{editorSelection:null!==(t=e.ui.editorSelection.get(e.ui.openedNote))&&void 0!==t?t:[0,0,"LTR"],fontSize:e.settings.fontSize,keyboardShortcuts:e.settings.keyboardShortcuts,noteId:e.ui.openedNote,note:e.data.notes.get(e.ui.openedNote),searchQuery:e.ui.searchQuery,spellCheckEnabled:e.settings.spellCheckEnabled,theme:q.a(e)}}),ae)(ie),ue=n(381);function se(e){return(se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function le(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function fe(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function de(e,t){return(de=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function pe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=ge(e);if(t){var r=ge(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return he(this,n)}}function he(e,t){return!t||"object"!==se(t)&&"function"!=typeof t?ve(e):t}function ve(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ge(e){return(ge=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function me(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ye=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&de(e,t)}(c,e);var t,n,i,a=pe(c);function c(){var e;le(this,c);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return me(ve(e=a.call.apply(a,[this].concat(n))),"noteDetail",Object(o.createRef)()),me(ve(e),"focusEditor",(function(){return e.focusContentEditor&&e.focusContentEditor()})),me(ve(e),"hasFocus",(function(){var t,n;return null===(t=(n=e).editorHasFocus)||void 0===t?void 0:t.call(n)})),me(ve(e),"storeEditorHasFocus",(function(t){return e.editorHasFocus=t})),me(ve(e),"storeFocusContentEditor",(function(t){return e.focusContentEditor=t})),e}return t=c,(n=[{key:"componentDidMount",value:function(){this.props.storeFocusEditor(this.focusEditor),this.props.storeHasFocus(this.hasFocus)}},{key:"render",value:function(){var e=this.props,t=e.fontSize,n=e.openedNote;return r.a.createElement("div",{className:"note-detail-wrapper"},n?r.a.createElement("div",{ref:this.noteDetail,className:"note-detail"},r.a.createElement("div",{className:"note-detail-textarea theme-color-bg theme-color-fg",style:{fontSize:"".concat(t,"px"),overflowY:"hidden"}},r.a.createElement(ce,{storeFocusEditor:this.storeFocusContentEditor,storeHasFocus:this.storeEditorHasFocus}))):r.a.createElement("div",{className:"note-detail-placeholder"},r.a.createElement(ue.a,null)))}}])&&fe(t.prototype,n),i&&fe(t,i),c}(o.Component);me(ye,"displayName","NoteDetail");var be=Object(i.b)((function(e){return{fontSize:e.settings.fontSize,isDialogOpen:e.ui.dialogs.length>0,keyboardShortcuts:e.settings.keyboardShortcuts,openedNote:e.ui.openedNote}}))(ye),we=n(649);function Se(e){return(Se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ee(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Te(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Oe(e,t){return(Oe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ke(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Ce(e);if(t){var r=Ce(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Ne(this,n)}}function Ne(e,t){return!t||"object"!==Se(t)&&"function"!=typeof t?Fe(e):t}function Fe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ce(e){return(Ce=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ie(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var je=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Oe(e,t)}(a,e);var t,n,o,i=ke(a);function a(){var e;Ee(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return Ie(Fe(e=i.call.apply(i,[this].concat(n))),"markdownEnabled",(function(){var t;return null===(t=e.props.note)||void 0===t?void 0:t.systemTags.includes("markdown")})),Ie(Fe(e),"handleShortcut",(function(t){if(e.props.keyboardShortcuts){var n,o,r,i,a=t.code,c=t.ctrlKey,u=t.metaKey,s=t.shiftKey,l=e.props,f=l.note,d=l.noteId,p=l.toggleMarkdown,h=c||u;return f&&h&&s&&"KeyM"===a?(console.log("toggling markdown"),p(d,!e.markdownEnabled()),t.stopPropagation(),t.preventDefault(),!1):h&&s&&"KeyP"===a&&e.markdownEnabled()?(e.props.toggleEditMode(),t.stopPropagation(),t.preventDefault(),!1):!(s&&h&&"KeyY"===a&&e.props.isEditorActive)||(e.editFieldHasFocus()?(null===(n=(o=e).focusTagField)||void 0===n||n.call(o),t.stopPropagation(),t.preventDefault(),!1):(null===(r=(i=e).focusNoteEditor)||void 0===r||r.call(i),t.stopPropagation(),t.preventDefault(),!1))}})),Ie(Fe(e),"editFieldHasFocus",(function(){return e.editorHasFocus&&e.editorHasFocus()})),Ie(Fe(e),"storeEditorHasFocus",(function(t){return e.editorHasFocus=t})),Ie(Fe(e),"storeFocusEditor",(function(t){return e.focusNoteEditor=t})),Ie(Fe(e),"storeFocusTagField",(function(t){return e.focusTagField=t})),Ie(Fe(e),"storeTagFieldHasFocus",(function(t){return e.tagFieldHasFocus=t})),Ie(Fe(e),"tagFieldHasFocus",(function(){return e.tagFieldHasFocus&&e.tagFieldHasFocus()})),Ie(Fe(e),"toggleShortcuts",(function(t){t?window.addEventListener("keydown",e.handleShortcut,!0):window.removeEventListener("keydown",e.handleShortcut,!0)})),e}return t=a,(n=[{key:"componentDidMount",value:function(){var e=this;this.toggleShortcuts(!0),this.timer=setInterval((function(){var t;return null==e||null===(t=e.forceUpdate)||void 0===t?void 0:t.call(e)}),1e3)}},{key:"componentWillUnmount",value:function(){this.toggleShortcuts(!1),clearTimeout(this.timer)}},{key:"render",value:function(){var e=this.props,t=e.editMode,n=e.lastUpdated,o=e.note,i=e.noteId;if(!o)return r.a.createElement("div",{className:"note-detail-placeholder"},r.a.createElement(ue.a,null));var a=!!o.deleted;return r.a.createElement("div",{className:"note-editor theme-color-bg theme-color-fg"},r.a.createElement("div",null,"Note last updated: ",Math.floor((Date.now()-n)/1e3),"s ago (",new Date(n).toLocaleTimeString(),")"),t||!o.systemTags.includes("markdown")?r.a.createElement(be,{storeFocusEditor:this.storeFocusEditor,storeHasFocus:this.storeEditorHasFocus}):r.a.createElement(we.default,{noteId:i}),o&&!a&&r.a.createElement(K,{storeFocusTagField:this.storeFocusTagField,storeHasFocus:this.storeTagFieldHasFocus}))}}])&&Te(t.prototype,n),o&&Te(t,o),a}(o.Component);Ie(je,"displayName","NoteEditor");var De={toggleNoteList:$.a.ui.toggleNoteList,toggleMarkdown:$.a.data.markdownNote,toggleEditMode:$.a.ui.toggleEditMode};t.default=Object(i.b)((function(e){return{allTags:e.data.tags[0],editMode:e.ui.editMode,keyboardShortcuts:e.settings.keyboardShortcuts,isEditorActive:!e.ui.showNavigation,lastUpdated:e.simperium.lastSync.get(e.ui.openedNote),noteId:e.ui.openedNote,note:e.data.notes.get(e.ui.openedNote),revision:e.ui.selectedRevision,isSmallScreen:q.b(e)}}),De)(je)},649:function(e,t,n){"use strict";n.r(t),n.d(t,"NotePreview",(function(){return y}));var o=n(0),r=n.n(o),i=n(130),a=n(252),c=n(643),u=n.n(c),s=n(644),l=n.n(s),f=n(3),d={type:"output",regex:'<input type="checkbox" disabled',replace:'<input type="checkbox" '},p=function(e){return n.e(11).then(n.t.bind(null,1316,7)).then((function(t){var n=t.default;n.extension("enableCheckboxes",d);var o=new n.Converter({extensions:["enableCheckboxes"]});o.setFlavor("github"),o.setOption("simpleLineBreaks",!1),o.setOption("ghMentions",!1),o.setOption("smoothLivePreview",!0);var r=e.replace(/([ \t\u2000-\u200a]*)\u2022(\s)/gm,"$1-$2");return function(e){for(var t=(new DOMParser).parseFromString(e,"text/html"),n=t.createTreeWalker(t.body,NodeFilter.SHOW_ALL,null,!1),o=[],r=[],i=function(){var e=n.currentNode;if(function(e){switch(e.nodeName.toLowerCase()){case"head":case"html":case"iframe":case"link":case"meta":case"object":case"script":case"style":return!0;default:return!1}}(e))return r.push(e),"continue";if(!function(e){var t=e.nodeName.toLowerCase();if("input"===t)return"checkbox"===e.getAttribute("type");switch(t){case"#text":case"a":case"article":case"b":case"br":case"blockquote":case"cite":case"code":case"dd":case"del":case"div":case"dt":case"em":case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":case"hr":case"i":case"img":case"ins":case"kbd":case"li":case"ol":case"p":case"pre":case"s":case"span":case"strong":case"sub":case"sup":case"table":case"tbody":case"td":case"th":case"thead":case"tr":case"tt":case"ul":return!0;default:return!1}}(e))return o.push(e),"continue";var t=e.nodeName.toLowerCase();Object(f.filter)(e.attributes,(function(e){var n=e.name,o=e.value;return!function(e,t,n){switch(e){case"a":switch(t){case"href":return!n.toLowerCase().trim().startsWith("javascript");case"alt":case"rel":case"title":return!0;default:return!1}case"img":switch(t){case"alt":case"src":case"title":case"width":return!0;default:return!1}case"input":switch(t){case"disabled":case"checked":case"type":return!0;default:return!1}case"li":switch(t){case"class":switch(n){case"task-list-item":return!0;default:return!1}default:return!1}case"ol":switch(t){case"start":return!0;default:return!1}default:return!1}}(t,n,o)&&(("href"!==n&&"src"!==n||!l.a.isWebUri(o))&&("href"!==n||!o.startsWith("mailto:")||!u.a.validate(o.slice(7))))})).forEach((function(t){var n=t.name;return e.removeAttribute(n)}));var i="a"===t&&e.getAttribute("href");"a"!==t||"string"!=typeof i||i.startsWith("mailto:")||(e.setAttribute("target","_blank"),e.setAttribute("rel","external noopener noreferrer")),"li"===t&&"task-list-item"===e.getAttribute("class")&&e.setAttribute("style","list-style: none;")};n.nextNode();)i();return r.forEach((function(e){try{var t;null==e||null===(t=e.parentNode)||void 0===t||t.removeChild(e)}catch(e){}})),o.forEach((function(e){var t,n=e.parentNode;try{for(;t=e.firstChild;)null==n||n.insertBefore(t,e);null==n||n.removeChild(e)}catch(e){}})),t.body.innerHTML}(o.makeHtml(r))}))},h=function(e,t,o){p(t).then((function(t){return e.innerHTML=t,e})).then((function(e){if(!o)return e.querySelectorAll("pre code");var t=Object(a.a)(o).map((function(e){return e.toLocaleLowerCase()}));if(!t.length)return e.querySelectorAll("pre code");for(var n=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:function(e){return t.some((function(t){var n;return null===(n=e.textContent)||void 0===n?void 0:n.toLocaleLowerCase().includes(t)}))?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}},!1),r=[],i=n.currentNode;i;)r.push(i),i=n.nextNode();return r.forEach((function(e){return function e(t,n){var o=t.parentNode;n.forEach((function(t){o.childNodes.forEach((function(o){var r,i,a;if(o.nodeType===Node.TEXT_NODE&&(null===(r=o.textContent)||void 0===r?void 0:r.toLocaleLowerCase().includes(t))){var c=null===(i=o.textContent)||void 0===i?void 0:i.toLocaleLowerCase().indexOf(t),u=o.splitText(c),s=u.splitText(t.length),l=document.createElement("span");l.setAttribute("class","search-match"),null===(a=u.parentNode)||void 0===a||a.replaceChild(l,u),l.appendChild(u),e(s,n)}}))}))}(e,t)})),e.querySelectorAll("pre code")})).then((function(e){if(e.length)return n.e(7).then(n.t.bind(null,1315,7)).then((function(t){var n=t.default;e.forEach(n.highlightBlock)})).catch()}))},v=n(26),g=n(152);function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var y=function(e){var t=e.editNote,n=e.fontSize,i=e.note,a=e.noteId,c=e.searchQuery,u=Object(o.useRef)();return Object(o.useEffect)((function(){var e,n=function(e){for(var n=e.target;null!==n;n=n.parentNode){if("A"===i.tagName)return e.preventDefault(),e.stopPropagation(),void(n.href.startsWith("http://localhost")||Object(v.a)(n.href));if("task-list-item"===n.className){var o=function(){e.preventDefault(),e.stopPropagation();var o=u.current.querySelectorAll("[data-markdown-root] .task-list-item"),r=Array.prototype.indexOf.call(o,n),c=0,s=i.content.replace(/[\ue000|\ue001]/g,(function(e){return c++===r?""===e?"":"":e}));return t(a,{content:s}),{v:void 0}}();if("object"===m(o))return o.v}}};return null===(e=u.current)||void 0===e||e.addEventListener("click",n,!0),function(){var e;return null===(e=u.current)||void 0===e?void 0:e.removeEventListener("click",n,!0)}}),[]),Object(o.useEffect)((function(){u.current&&(null==i?void 0:i.content)&&(null==i?void 0:i.systemTags.includes("markdown"))&&h(u.current,i.content,c)}),[null==i?void 0:i.content,null==i?void 0:i.systemTags,c]),r.a.createElement("div",{className:"note-detail-wrapper"},r.a.createElement("div",{className:"note-detail"},r.a.createElement("div",{ref:u,className:"note-detail-markdown theme-color-bg theme-color-fg","data-markdown-root":!0,style:{fontSize:"".concat(n,"px")}},r.a.createElement("div",{style:{whiteSpace:"pre"}},null==i?void 0:i.content))))},b={editNote:g.a.data.editNote};t.default=Object(i.b)((function(e,t){var n,o;return{fontSize:e.settings.fontSize,note:null!==(n=t.note)&&void 0!==n?n:e.data.notes.get(t.noteId),noteId:null!==(o=t.noteId)&&void 0!==o?o:e.ui.openedNote,searchQuery:e.ui.searchQuery}}),b)(y)}}]);